<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Panel Admin ‚Äî AeroVuelos</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --red: #D32F2F; --red-dark: #B71C1C;
    --sidebar: #1a1a2e; --sidebar2: #16213e;
    --white: #fff; --gray: #F5F5F5; --muted: #888;
    --green: #2e7d32; --orange: #e65100; --blue: #1565c0;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family:'DM Sans',sans-serif; background:#f0f2f5; display:flex; min-height:100vh; }

  /* SIDEBAR */
  .sidebar {
    width: 240px; background: var(--sidebar);
    min-height: 100vh; padding: 0; position: fixed; left:0; top:0;
    display: flex; flex-direction: column;
  }
  .sidebar-logo {
    padding: 24px 20px; border-bottom: 1px solid rgba(255,255,255,0.08);
    font-size: 18px; font-weight: 700; color: white;
  }
  .sidebar-logo span { color: var(--red); }
  .sidebar-nav { flex: 1; padding: 16px 0; }
  .nav-item {
    display: flex; align-items: center; gap: 12px;
    padding: 12px 20px; color: rgba(255,255,255,0.6);
    cursor: pointer; font-size: 14px; font-weight: 500;
    transition: all 0.2s; border-left: 3px solid transparent;
  }
  .nav-item:hover { background: rgba(255,255,255,0.06); color: white; }
  .nav-item.active { background: rgba(211,47,47,0.15); color: white; border-left-color: var(--red); }
  .nav-item-icon { font-size: 18px; }

  .sidebar-footer {
    padding: 16px 20px; border-top: 1px solid rgba(255,255,255,0.08);
    color: rgba(255,255,255,0.4); font-size: 12px;
  }

  /* MAIN */
  .main { margin-left: 240px; flex: 1; }
  .topbar {
    background: white; padding: 0 32px; height: 64px;
    display: flex; align-items: center; justify-content: space-between;
    border-bottom: 1px solid #e0e0e0;
    position: sticky; top: 0; z-index: 50;
    box-shadow: 0 1px 8px rgba(0,0,0,0.06);
  }
  .topbar h1 { font-size: 18px; font-weight: 700; }
  .topbar-right { display: flex; align-items: center; gap: 16px; }
  .admin-badge {
    background: var(--red); color: white;
    padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;
  }

  .content { padding: 32px; }

  /* STATS */
  .stats-grid { display: grid; grid-template-columns: repeat(4,1fr); gap: 20px; margin-bottom: 32px; }
  .stat-card {
    background: white; border-radius: 14px; padding: 24px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.06);
  }
  .stat-label { font-size: 12px; font-weight: 600; color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
  .stat-value { font-size: 32px; font-weight: 700; }
  .stat-icon { font-size: 28px; float: right; margin-top: -4px; }
  .stat-sub { font-size: 12px; color: var(--muted); margin-top: 6px; }

  /* TABS */
  .tab-nav { display: flex; gap: 4px; margin-bottom: 24px; background: white; border-radius: 10px; padding: 6px; display: inline-flex; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
  .tab-nav button {
    padding: 8px 20px; border: none; border-radius: 7px; cursor: pointer;
    font-size: 13px; font-weight: 500; font-family: 'DM Sans', sans-serif;
    background: transparent; color: var(--muted); transition: all 0.2s;
  }
  .tab-nav button.active { background: var(--red); color: white; }

  /* TABLE */
  .table-card { background: white; border-radius: 14px; overflow: hidden; box-shadow: 0 2px 12px rgba(0,0,0,0.06); }
  .table-header { padding: 20px 24px; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; }
  .table-header h3 { font-size: 15px; font-weight: 600; }
  .search-input { padding: 8px 14px; border: 1.5px solid #e0e0e0; border-radius: 8px; font-size: 13px; outline: none; font-family: 'DM Sans',sans-serif; width: 200px; }
  .search-input:focus { border-color: var(--red); }
  table { width: 100%; border-collapse: collapse; }
  th { padding: 12px 24px; background: #fafafa; font-size: 12px; font-weight: 600; color: var(--muted); text-transform: uppercase; letter-spacing: 0.4px; text-align: left; }
  td { padding: 14px 24px; border-top: 1px solid #f5f5f5; font-size: 13px; }
  tr:hover td { background: #fafafa; }

  .badge {
    padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 600;
  }
  .badge-pending  { background: #fff3e0; color: #e65100; }
  .badge-confirmed { background: #e8f5e9; color: #2e7d32; }
  .badge-rejected { background: #ffebee; color: #c62828; }

  .action-btn {
    padding: 5px 12px; border-radius: 6px; border: none; cursor: pointer;
    font-size: 12px; font-weight: 500; font-family: 'DM Sans',sans-serif;
    transition: all 0.2s; margin-right: 4px;
  }
  .btn-confirm { background: #e8f5e9; color: var(--green); }
  .btn-confirm:hover { background: var(--green); color: white; }
  .btn-reject  { background: #ffebee; color: var(--red); }
  .btn-reject:hover  { background: var(--red); color: white; }

  /* PANEL SECTIONS */
  .section { display: none; }
  .section.active { display: block; }

  /* USER TABLE */
  .empty-state { text-align: center; padding: 60px 20px; color: var(--muted); }
  .empty-icon { font-size: 48px; margin-bottom: 12px; }

  /* REFRESH BTN */
  .btn-refresh {
    background: var(--red); color: white; border: none;
    padding: 8px 16px; border-radius: 8px; cursor: pointer;
    font-size: 13px; font-weight: 500; font-family:'DM Sans',sans-serif;
  }

  /* TELEGRAM CONFIG */
  .config-card { background: white; border-radius: 14px; padding: 28px; box-shadow: 0 2px 12px rgba(0,0,0,0.06); max-width: 600px; }
  .config-card h3 { font-size: 16px; font-weight: 600; margin-bottom: 20px; }
  .config-group { margin-bottom: 18px; }
  .config-label { font-size: 12px; font-weight: 600; color: var(--muted); text-transform: uppercase; letter-spacing: 0.4px; margin-bottom: 6px; display: block; }
  .config-input { width: 100%; border: 1.5px solid #e0e0e0; border-radius: 8px; padding: 10px 14px; font-size: 14px; font-family:'DM Sans',sans-serif; outline: none; }
  .config-input:focus { border-color: var(--red); }
  .btn-save { background: var(--red); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; font-family:'DM Sans',sans-serif; }

  @media(max-width:768px) {
    .sidebar { display:none; }
    .main { margin-left:0; }
    .stats-grid { grid-template-columns:1fr 1fr; }
  }
</style>
</head>
<body>

<!-- SIDEBAR -->
<div class="sidebar">
  <div class="sidebar-logo">‚úà <span>Aero</span>Vuelos<br><small style="font-size:11px;opacity:0.5;font-weight:400">Panel Administrador</small></div>
  <nav class="sidebar-nav">
    <div class="nav-item active" onclick="showSection('dashboard',this)">
      <span class="nav-item-icon">üìä</span> Dashboard
    </div>
    <div class="nav-item" onclick="showSection('reservas',this)">
      <span class="nav-item-icon">üé´</span> Reservas
    </div>
    <div class="nav-item" onclick="showSection('usuarios',this)">
      <span class="nav-item-icon">üë•</span> Usuarios
    </div>
    <div class="nav-item" onclick="showSection('vuelos',this)">
      <span class="nav-item-icon">‚úàÔ∏è</span> Vuelos
    </div>
    <div class="nav-item" onclick="showSection('config',this)">
      <span class="nav-item-icon">‚öôÔ∏è</span> Configuraci√≥n
    </div>
  </nav>
  <div class="sidebar-footer">
    AeroVuelos Admin v1.0<br>
    <a href="index.html" style="color:rgba(255,255,255,0.4);text-decoration:none">‚Üê Ver sitio web</a>
  </div>
</div>

<!-- MAIN -->
<div class="main">
  <div class="topbar">
    <h1 id="pageTitle">Dashboard</h1>
    <div class="topbar-right">
      <button class="btn-refresh" onclick="loadAll()">üîÑ Actualizar</button>
      <span class="admin-badge">üëë Admin</span>
    </div>
  </div>

  <div class="content">

    <!-- DASHBOARD -->
    <div class="section active" id="sec-dashboard">
      <div class="stats-grid">
        <div class="stat-card">
          <span class="stat-icon">üé´</span>
          <div class="stat-label">Total Reservas</div>
          <div class="stat-value" id="statTotal">0</div>
          <div class="stat-sub">Todas las reservas</div>
        </div>
        <div class="stat-card">
          <span class="stat-icon">‚è≥</span>
          <div class="stat-label">Pendientes</div>
          <div class="stat-value" id="statPending" style="color:#e65100">0</div>
          <div class="stat-sub">Requieren atenci√≥n</div>
        </div>
        <div class="stat-card">
          <span class="stat-icon">‚úÖ</span>
          <div class="stat-label">Confirmadas</div>
          <div class="stat-value" id="statConfirmed" style="color:#2e7d32">0</div>
          <div class="stat-sub">Reservas activas</div>
        </div>
        <div class="stat-card">
          <span class="stat-icon">üë•</span>
          <div class="stat-label">Usuarios</div>
          <div class="stat-value" id="statUsers">0</div>
          <div class="stat-sub">Registrados</div>
        </div>
      </div>

      <!-- √öltimas reservas -->
      <div class="table-card">
        <div class="table-header">
          <h3>√öltimas reservas</h3>
        </div>
        <table>
          <thead>
            <tr>
              <th>C√≥digo</th>
              <th>Pasajero</th>
              <th>Ruta</th>
              <th>Total</th>
              <th>M√©todo</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="dashTable">
            <tr><td colspan="7"><div class="empty-state"><div class="empty-icon">üé´</div>No hay reservas a√∫n</div></td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- RESERVAS -->
    <div class="section" id="sec-reservas">
      <div class="tab-nav" style="margin-bottom:20px">
        <button class="active" onclick="filterReservas('TODAS',this)">Todas</button>
        <button onclick="filterReservas('PENDIENTE',this)">Pendientes</button>
        <button onclick="filterReservas('CONFIRMADA',this)">Confirmadas</button>
        <button onclick="filterReservas('RECHAZADA',this)">Rechazadas</button>
      </div>
      <div class="table-card">
        <div class="table-header">
          <h3>Gesti√≥n de reservas</h3>
          <input class="search-input" id="searchReservas" placeholder="üîç Buscar..." oninput="searchTable('reservas',this.value)">
        </div>
        <table>
          <thead>
            <tr>
              <th>C√≥digo</th>
              <th>Fecha</th>
              <th>Pasajero</th>
              <th>Doc.</th>
              <th>Ruta</th>
              <th>Hora</th>
              <th>Total</th>
              <th>M√©todo</th>
              <th>Comprobante</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="reservasTable">
            <tr><td colspan="11"><div class="empty-state"><div class="empty-icon">üé´</div>No hay reservas a√∫n</div></td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- USUARIOS -->
    <div class="section" id="sec-usuarios">
      <div class="table-card">
        <div class="table-header">
          <h3>Usuarios registrados</h3>
          <input class="search-input" id="searchUsuarios" placeholder="üîç Buscar..." oninput="searchTable('usuarios',this.value)">
        </div>
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Nombre</th>
              <th>Email</th>
              <th>Tel√©fono</th>
              <th>Reservas</th>
            </tr>
          </thead>
          <tbody id="usuariosTable">
            <tr><td colspan="5"><div class="empty-state"><div class="empty-icon">üë•</div>No hay usuarios a√∫n</div></td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- VUELOS -->
    <div class="section" id="sec-vuelos">
      <div class="table-card">
        <div class="table-header">
          <h3>Gesti√≥n de vuelos</h3>
        </div>
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Ruta</th>
              <th>Hora salida</th>
              <th>Llegada</th>
              <th>Duraci√≥n</th>
              <th>Precio base</th>
              <th>Tasas</th>
            </tr>
          </thead>
          <tbody id="vuelosTable"></tbody>
        </table>
      </div>
    </div>

    <!-- CONFIG -->
    <div class="section" id="sec-config">
      <div class="config-card">
        <h3>‚öôÔ∏è Configuraci√≥n del sistema</h3>
        <div class="config-group">
          <label class="config-label">ü§ñ Telegram Bot Token</label>
          <input class="config-input" id="cfgToken" type="text" placeholder="1234567890:ABC...">
        </div>
        <div class="config-group">
          <label class="config-label">üí¨ Telegram Chat ID</label>
          <input class="config-input" id="cfgChatId" type="text" placeholder="-100XXXXXXXXXX o @tucanal">
        </div>
        <hr style="margin:24px 0;border:none;border-top:1px solid #f0f0f0">
        <div class="config-group">
          <label class="config-label">üíú N√∫mero Nequi</label>
          <input class="config-input" id="cfgNequi" type="text" placeholder="3XX XXX XXXX">
        </div>
        <div class="config-group">
          <label class="config-label">üíõ N√∫mero Daviplata</label>
          <input class="config-input" id="cfgDaviplata" type="text" placeholder="3XX XXX XXXX">
        </div>
        <div class="config-group">
          <label class="config-label">üè¶ Banco</label>
          <input class="config-input" id="cfgBanco" type="text" placeholder="Bancolombia">
        </div>
        <div class="config-group">
          <label class="config-label">üí≥ N√∫mero de cuenta</label>
          <input class="config-input" id="cfgCuenta" type="text" placeholder="XXXX-XXXX-XXXX">
        </div>
        <hr style="margin:24px 0;border:none;border-top:1px solid #f0f0f0">
        <div class="config-group">
          <label class="config-label">üîë Contrase√±a admin</label>
          <input class="config-input" id="cfgAdminPass" type="password" placeholder="Nueva contrase√±a">
        </div>
        <button class="btn-save" onclick="saveConfig()">üíæ Guardar configuraci√≥n</button>
      </div>
    </div>

  </div>
</div>

<script>
const vuelosMock = [
  { id:1, origen:'BOG', destino:'MDE', hora:'06:00', llegada:'07:10', duracion:'1h 10m', precio:180000, tasas:32000 },
  { id:2, origen:'BOG', destino:'MDE', hora:'10:30', llegada:'11:40', duracion:'1h 10m', precio:220000, tasas:32000 },
  { id:3, origen:'BOG', destino:'CTG', hora:'08:00', llegada:'09:20', duracion:'1h 20m', precio:310000, tasas:45000 },
  { id:4, origen:'BOG', destino:'MIA', hora:'11:00', llegada:'15:30', duracion:'4h 30m', precio:1200000, tasas:180000 },
  { id:5, origen:'BOG', destino:'MAD', hora:'22:00', llegada:'14:00+1', duracion:'10h',   precio:2800000, tasas:380000 },
];

function fmt(n) { return '$' + n.toLocaleString('es-CO'); }
function getReservas() { return JSON.parse(localStorage.getItem('av_reservas') || '[]'); }
function getUsers() { return JSON.parse(localStorage.getItem('av_users') || '[]'); }

let currentFilter = 'TODAS';

function showSection(name, el) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('sec-' + name).classList.add('active');
  el.classList.add('active');
  const titles = { dashboard:'Dashboard', reservas:'Reservas', usuarios:'Usuarios', vuelos:'Vuelos', config:'Configuraci√≥n' };
  document.getElementById('pageTitle').textContent = titles[name];
  loadAll();
}

function loadAll() {
  loadDashboard();
  loadReservas();
  loadUsuarios();
  loadVuelos();
  loadConfig();
}

function badgeHtml(estado) {
  const cls = { PENDIENTE:'pending', CONFIRMADA:'confirmed', RECHAZADA:'rejected' }[estado] || 'pending';
  return `<span class="badge badge-${cls}">${estado}</span>`;
}

function actionBtns(codigo) {
  return `<button class="action-btn btn-confirm" onclick="updateEstado('${codigo}','CONFIRMADA')">‚úÖ Confirmar</button>
          <button class="action-btn btn-reject" onclick="updateEstado('${codigo}','RECHAZADA')">‚ùå Rechazar</button>`;
}

function updateEstado(codigo, nuevoEstado) {
  const reservas = getReservas();
  const idx = reservas.findIndex(r => r.codigo === codigo);
  if (idx >= 0) {
    reservas[idx].estado = nuevoEstado;
    localStorage.setItem('av_reservas', JSON.stringify(reservas));

    // Notificar Telegram
    const r = reservas[idx];
    const { token, chatId } = getTelegramCfg();
    const emoji = nuevoEstado === 'CONFIRMADA' ? '‚úÖ' : '‚ùå';
    const msg = `${emoji} <b>RESERVA ${nuevoEstado}</b>\nüé´ C√≥digo: ${codigo}\nüë§ Pasajero: ${r.pasajero.nombre}\n‚úàÔ∏è ${r.vuelo.origen} ‚Üí ${r.vuelo.destino}\nüí∞ Total: ${fmt(r.total)}`;
    if (token && chatId) {
      fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ chat_id: chatId, text: msg, parse_mode:'HTML' })
      });
    }
    loadAll();
  }
}

function loadDashboard() {
  const reservas = getReservas();
  const users = getUsers();
  document.getElementById('statTotal').textContent = reservas.length;
  document.getElementById('statPending').textContent = reservas.filter(r => r.estado === 'PENDIENTE').length;
  document.getElementById('statConfirmed').textContent = reservas.filter(r => r.estado === 'CONFIRMADA').length;
  document.getElementById('statUsers').textContent = users.length;

  const tbody = document.getElementById('dashTable');
  if (!reservas.length) {
    tbody.innerHTML = '<tr><td colspan="7"><div class="empty-state"><div class="empty-icon">üé´</div>No hay reservas a√∫n</div></td></tr>';
    return;
  }
  tbody.innerHTML = [...reservas].reverse().slice(0,10).map(r => `
    <tr>
      <td><strong>${r.codigo}</strong></td>
      <td>${r.pasajero?.nombre || '-'}</td>
      <td>${r.vuelo?.origen} ‚Üí ${r.vuelo?.destino}</td>
      <td>${fmt(r.total)}</td>
      <td>${r.metodoPago}</td>
      <td>${badgeHtml(r.estado)}</td>
      <td>${actionBtns(r.codigo)}</td>
    </tr>
  `).join('');
}

function loadReservas(filter) {
  if (filter) currentFilter = filter;
  let reservas = getReservas();
  if (currentFilter !== 'TODAS') reservas = reservas.filter(r => r.estado === currentFilter);
  const tbody = document.getElementById('reservasTable');
  if (!reservas.length) {
    tbody.innerHTML = `<tr><td colspan="11"><div class="empty-state"><div class="empty-icon">üé´</div>No hay reservas ${currentFilter !== 'TODAS' ? currentFilter.toLowerCase() + 's' : ''}</div></td></tr>`;
    return;
  }
  tbody.innerHTML = [...reservas].reverse().map(r => `
    <tr>
      <td><strong>${r.codigo}</strong></td>
      <td style="font-size:12px">${r.fecha}</td>
      <td>${r.pasajero?.nombre || '-'}</td>
      <td>${r.pasajero?.doc || '-'}</td>
      <td>${r.vuelo?.origen} ‚Üí ${r.vuelo?.destino}</td>
      <td>${r.vuelo?.hora}</td>
      <td>${fmt(r.total)}</td>
      <td>${r.metodoPago}</td>
      <td>${r.comprobante || '‚Äî'}</td>
      <td>${badgeHtml(r.estado)}</td>
      <td>${actionBtns(r.codigo)}</td>
    </tr>
  `).join('');
}

function filterReservas(f, btn) {
  document.querySelectorAll('.tab-nav button').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  loadReservas(f);
}

function loadUsuarios() {
  const users = getUsers();
  const reservas = getReservas();
  const tbody = document.getElementById('usuariosTable');
  if (!users.length) {
    tbody.innerHTML = '<tr><td colspan="5"><div class="empty-state"><div class="empty-icon">üë•</div>No hay usuarios registrados</div></td></tr>';
    return;
  }
  tbody.innerHTML = users.map((u, i) => {
    const count = reservas.filter(r => r.usuario?.email === u.email).length;
    return `<tr>
      <td>${i+1}</td>
      <td>${u.nombre}</td>
      <td>${u.email}</td>
      <td>${u.tel}</td>
      <td><strong>${count}</strong></td>
    </tr>`;
  }).join('');
}

function loadVuelos() {
  document.getElementById('vuelosTable').innerHTML = vuelosMock.map(v => `
    <tr>
      <td>${v.id}</td>
      <td><strong>${v.origen} ‚Üí ${v.destino}</strong></td>
      <td>${v.hora}</td>
      <td>${v.llegada}</td>
      <td>${v.duracion}</td>
      <td>${fmt(v.precio)}</td>
      <td>${fmt(v.tasas)}</td>
    </tr>
  `).join('');
}

function loadConfig() {
  const defaults = {
    token: '8211219706:AAE3tN8m1u7OrV5txNiod4fwcpTlCk1FE8w',
    chatId: '3018614849',
    nequi: 'N/A',
    daviplata: '3203101096',
    daviplataLlave: '1005753450',
    banco: 'Daviplata',
    cuenta: '3203101096',
    wpp: '3018614849',
  };
  const cfg = { ...defaults, ...JSON.parse(localStorage.getItem('av_config') || '{}') };
  document.getElementById('cfgToken').value = cfg.token;
  document.getElementById('cfgChatId').value = cfg.chatId;
  document.getElementById('cfgNequi').value = cfg.nequi;
  document.getElementById('cfgDaviplata').value = cfg.daviplata;
  document.getElementById('cfgBanco').value = cfg.banco;
  document.getElementById('cfgCuenta').value = cfg.cuenta;
}

function saveConfig() {
  const cfg = {
    token: document.getElementById('cfgToken').value.trim(),
    chatId: document.getElementById('cfgChatId').value.trim(),
    nequi: document.getElementById('cfgNequi').value.trim(),
    daviplata: document.getElementById('cfgDaviplata').value.trim(),
    banco: document.getElementById('cfgBanco').value.trim(),
    cuenta: document.getElementById('cfgCuenta').value.trim(),
  };
  localStorage.setItem('av_config', JSON.stringify(cfg));
  alert('‚úÖ Configuraci√≥n guardada correctamente');
}

function getTelegramCfg() {
  const stored = JSON.parse(localStorage.getItem('av_config') || '{}');
  return {
    token: stored.token || '8211219706:AAE3tN8m1u7OrV5txNiod4fwcpTlCk1FE8w',
    chatId: stored.chatId || '3018614849',
  };
}

function searchTable(type, q) {
  q = q.toLowerCase();
  const tables = { reservas: 'reservasTable', usuarios: 'usuariosTable' };
  const rows = document.getElementById(tables[type]).querySelectorAll('tr');
  rows.forEach(row => {
    row.style.display = row.textContent.toLowerCase().includes(q) ? '' : 'none';
  });
}

// INIT
loadAll();
</script>
</body>
</html>
